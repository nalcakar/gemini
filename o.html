<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Question Generator</title>
  <style>
    #geminiApp {
      font-family: Arial, sans-serif;
      background: #f9fafb;
      padding: 20px;
      border-radius: 16px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    #geminiApp textarea, #geminiApp input {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      margin-bottom: 10px;
      line-height: 1.4;
      min-height: 32px;
      resize: vertical;
      overflow: auto;
    }
    #geminiApp button {
      padding: 10px 16px;
      font-size: 15px;
      border-radius: 10px;
      background-color: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
      margin: 6px;
    }
    .keyword-card, .question-card {
      background: white;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 14px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .keyword-card {
      border-left: 5px solid #3b82f6;
      background: #f0f9ff;
    }
    #loading, #success {
      text-align: center;
      font-weight: bold;
    }
    #success {
      color: green;
    }
    #mycontent {
      min-height: 150px;
      max-height: 300px;
      overflow: auto;
    }
.button {
  padding: 10px 16px;
  font-size: 15px;
  border-radius: 10px;
  background-color: #4f46e5;
  color: white;
  border: none;
  cursor: pointer;
  margin: 6px;
}
.manual-card {
  background: #fff7ed;
  border-left: 5px solid #f97316;
  padding: 18px;
  border-radius: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  margin-top: 24px;
  transition: all 0.3s ease;
}

.manual-card:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.manual-card h3 {
  color: #b45309;
  margin-top: 0;
  font-size: 18px;
}

.manual-card input {
  background-color: white;
  border: 1px solid #facc15;
  margin-bottom: 12px;
  padding-left: 10px;
}

.manual-card input:focus {
  border-color: #fb923c;
  outline: none;
}

.manual-card button {
  background-color: #f97316;
  border: none;
  color: white;
  padding: 10px 16px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 15px;
}

.manual-card button:hover {
  background-color: #ea580c;
}
#mycontent {
  background-color: #fff7ed;           /* soft orange background */
  color: #3b0764;                      /* dark purple text */
  font-family: 'Segoe UI', sans-serif;
  font-size: 15px;
  letter-spacing: 0.3px;
  line-height: 1.6;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #f59e0b;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: box-shadow 0.3s ease;
}
#mycontent:focus {
  outline: none;
  border-color: #fb923c;
  box-shadow: 0 0 4px rgba(251, 146, 60, 0.6);
}

#mycontent {
  background-color: #fff7ed;           /* soft orange background */
  color: #3b0764;                      /* dark purple text */
  font-family: 'Segoe UI', sans-serif;
  font-size: 15px;
  letter-spacing: 0.3px;
  line-height: 1.6;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #f59e0b;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: box-shadow 0.3s ease;
}
#mycontent:focus {
  outline: none;
  border-color: #fb923c;
  box-shadow: 0 0 4px rgba(251, 146, 60, 0.6);
}
.dot-typing {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 80px;
  height: 24px;
  position: relative;
}
.dot-typing::before,
.dot-typing::after,
.dot-typing div {
  content: '';
  display: block;
  width: 12px;
  height: 12px;
  background: #4f46e5;
  border-radius: 50%;
  position: absolute;
  animation: blink 1.4s infinite ease-in-out both;
}
.dot-typing::before { left: -20px; animation-delay: -0.32s; }
.dot-typing div     { left:   0px; animation-delay: -0.16s; }
.dot-typing::after  { left:  20px; }

@keyframes blink {
  0%, 80%, 100% { transform: scale(0); opacity: 0.4; }
  40%          { transform: scale(1); opacity: 1; }
}

  </style>
</head>
<body>
  <div id="loadingOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:9999; display:flex; align-items:center; justify-content:center;">
    <div class="dot-typing"><div></div></div>
  </div>
<div id="geminiApp">
  <h3>üìò Enter Your Text:</h3>
  <textarea id="mycontent" rows="16" placeholder="Paste or type your content here..."></textarea>
<div style="font-size: 13px; color: gray; margin-top: 4px;">
  <span id="mycontentCharCount">0</span> / 10,000 characters
</div>
<div id="mycontentCharWarning" style="color: red; font-weight: bold; display: none; margin-top: 4px;">
  ‚ö†Ô∏è Maximum character limit reached. Extra text will be trimmed automatically.
</div>
  <div style="text-align:center">
    <button onclick="generateGeminiKeywords()">Generate Keywords</button>
  </div>

  <div id="loading" style="display:none;">‚è≥ Processing...</div>
  <div id="success"></div>

  <div id="keywordsResult"></div>


<div id="manualKeywordSection" style="display: none;" class="manual-card">
  <h3>‚ûï Add Manual Keyword</h3>
  <input type="text" id="manualKeyword" placeholder="‚úèÔ∏è Type your keyword here..." />
  <div style="text-align: center;">
    <button onclick="addManualKeyword()">üîç Add with AI Explanation</button>
  </div>
</div>

<div style="text-align:center; margin-top:10px;">
  <button id="downloadKeywordsBtn" class="button" onclick="downloadKeywordsTXT()" style="display:none;">
    üì• Download Keywords as .TXT
  </button>
</div>

  <h4>üìå File Title (required):</h4>
  <input type="text" id="fileTitle" placeholder="e.g., Heart Review" />
  <p id="warning" style="color:red; display:none;">‚ö†Ô∏è Please enter a title.</p>


<script>
  function showLoading() {
  const overlay = document.getElementById("loadingOverlay");
  if (overlay) {
    overlay.style.display = "flex";
    document.body.style.overflow = "hidden"; // kaydƒ±rmayƒ± engelle
  }
}

function hideLoading() {
  const overlay = document.getElementById("loadingOverlay");
  if (overlay) {
    overlay.style.display = "none";
    document.body.style.overflow = "";
  }
}
window.addEventListener("load", () => {
  setTimeout(() => {
    document.querySelectorAll("textarea").forEach(t => {
      if (t.id !== "mycontent") {
        t.setAttribute("rows", "1");
        autoResize(t);
      }
    });
  }, 200);

  const textarea = document.getElementById("mycontent");
  const saved = localStorage.getItem("mycontentText");
  if (saved) {
    textarea.value = saved.slice(0, maxChars);
    mycontentCharCount.textContent = textarea.value.length;
    if (textarea.value.length >= maxChars) {
      mycontentCharWarning.style.display = "block";
    }
  }

  textarea.addEventListener("input", () => {
    localStorage.setItem("mycontentText", textarea.value);
  });
});

function autoResize(el) {
  el.style.height = "auto";
  el.style.height = (el.scrollHeight) + "px";
}

function validateTitle() {
  const title = document.getElementById("fileTitle").value.trim();
  const warning = document.getElementById("warning");
  if (!title) {
    warning.style.display = "block";
    return null;
  }
  warning.style.display = "none";
  return title;
}

function formatKeywordsOnly() {
  let result = "www.doitwithai.org\n\nüìå Keywords:\n\n";
  document.querySelectorAll(".keyword-card").forEach(card => {
    const keyword = card.querySelector(".kword").innerText.trim();
    const explanation = card.querySelector(".explanation").innerText.trim();
    result += `- ${keyword}: ${explanation}\n`;
  });
  result += "\nwww.doitwithai.org";
  return result;
}

function downloadKeywordsTXT() {
  const title = validateTitle();
  if (!title) return;

  showLoading(); // ‚ú® g√∂ster

  setTimeout(() => {
    const formatted = formatKeywordsOnly();
    const blob = new Blob(["\uFEFF" + formatted], { type: "text/plain;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `${title}_keywords.txt`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    hideLoading(); // ‚ú® gizle
  }, 300); // kƒ±sa bir bekleme s√ºresi ile daha yumu≈üak
}


function editKeyword(btn) {
  const card = btn.closest(".keyword-card");
  card.querySelector(".view-mode").style.display = "none";
  card.querySelector(".edit-mode").style.display = "block";
}

function deleteKeyword(btn) {
  const card = btn.closest(".keyword-card");
  card.remove();
}

function saveKeyword(btn) {
  const card = btn.closest(".keyword-card");
  const newKeyword = card.querySelector(".edit-kword").value.trim();
  const newExplanation = card.querySelector(".edit-explanation").value.trim();
  card.querySelector(".kword").textContent = newKeyword;
  card.querySelector(".explanation").textContent = newExplanation;
  card.querySelector(".view-mode").style.display = "block";
  card.querySelector(".edit-mode").style.display = "none";
}

function cancelEdit(btn) {
  const card = btn.closest(".keyword-card");
  card.querySelector(".view-mode").style.display = "block";
  card.querySelector(".edit-mode").style.display = "none";
}

async function generateGeminiKeywords() {
  const mycontent = document.getElementById("mycontent").value.trim();
  const loading = document.getElementById("loading");
  const keywordsResult = document.getElementById("keywordsResult");
  const success = document.getElementById("success");
  const manualSection = document.getElementById("manualKeywordSection");

  showLoading(); // EKRANI G√ñSTER
  loading.style.display = "block";
  success.textContent = "";
  keywordsResult.innerHTML = "";
  document.getElementById("downloadKeywordsBtn").style.display = "none";

  if (!mycontent) {
    success.textContent = "‚ö†Ô∏è Please enter some content before generating keywords.";
    loading.style.display = "none";
    hideLoading(); // EKRANI KAPAT
    if (manualSection) manualSection.style.display = "none";
    return;
  }

  try {
    const keywordRes = await fetch("https://gemini-j8xd.onrender.com/generate-keywords", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ mycontent })
    });

    const kwData = await keywordRes.json();

    if (kwData.keywords) {
      const items = kwData.keywords.split("\n").filter(line => line.startsWith("-"));
      items.forEach(line => {
        const [keyword, explanation] = line.substring(1).split(":");
        if (keyword && explanation) {
          const div = document.createElement("div");
          div.className = "keyword-card";
          div.innerHTML = `
            <div class="view-mode">
              <strong class="kword">${keyword.trim()}</strong><br>
              <span class="explanation">${explanation.trim()}</span><br>
              <button onclick="editKeyword(this)">Edit</button>
              <button onclick="deleteKeyword(this)">Delete</button>
            </div>
            <div class="edit-mode" style="display:none;">
              <input type="text" class="edit-kword" value="${keyword.trim()}" />
              <input type="text" class="edit-explanation" value="${explanation.trim()}" />
              <button onclick="saveKeyword(this)">Save</button>
              <button onclick="cancelEdit(this)">Cancel</button>
            </div>
          `;
          keywordsResult.appendChild(div);
        }
      });

      success.textContent = "‚úî Keywords successfully generated.";
      document.getElementById("downloadKeywordsBtn").style.display = "block";
      if (manualSection) manualSection.style.display = "block";
    } else {
      success.textContent = "‚ö†Ô∏è Failed to receive keywords.";
      if (manualSection) manualSection.style.display = "none";
    }
  } catch (err) {
    success.textContent = "‚ùå An error occurred: " + err.message;
    if (manualSection) manualSection.style.display = "none";
  } finally {
    loading.style.display = "none";
    hideLoading(); // ƒ∞≈ûLEM TAMAM, KAPAT
  }
}



async function addManualKeyword() {
  const keywordInput = document.getElementById("manualKeyword");
  const keyword = keywordInput.value.trim();
  const mycontent = document.getElementById("mycontent").value.trim();

  if (!keyword) {
    alert("Please enter a keyword.");
    return;
  }

  showLoading(); // ‚ú® g√∂ster
  const loading = document.getElementById("loading");
  loading.style.display = "block";

  try {
    const res = await fetch("https://gemini-j8xd.onrender.com/define-keyword", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ keyword, mycontent })
    });

    const data = await res.json();

    if (data.explanation) {
      const div = document.createElement("div");
      div.className = "keyword-card";
      div.innerHTML = `
        <div class="view-mode">
          <strong class="kword">${keyword}</strong><br>
          <span class="explanation">${data.explanation}</span><br>
          <small style="color:gray">üí¨ Context-based explanation (${data.lang})</small><br>
          <button onclick="editKeyword(this)">Edit</button>
          <button onclick="deleteKeyword(this)">Delete</button>
        </div>
        <div class="edit-mode" style="display:none;">
          <input type="text" class="edit-kword" value="${keyword}" />
          <input type="text" class="edit-explanation" value="${data.explanation}" />
          <button onclick="saveKeyword(this)">Save</button>
          <button onclick="cancelEdit(this)">Cancel</button>
        </div>
      `;
      document.getElementById("keywordsResult").appendChild(div);
      document.getElementById("downloadKeywordsBtn").style.display = "block";
      keywordInput.value = "";
    } else {
      alert("No explanation received from AI.");
    }
  } catch (err) {
    alert("‚ùå An error occurred: " + err.message);
  } finally {
    loading.style.display = "none";
    hideLoading(); // ‚ú® gizle
  }
}


</script>

</body>
</html>